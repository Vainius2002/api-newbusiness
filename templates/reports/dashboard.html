{% extends "base.html" %}

{% block title %}Analytics Dashboard - Media Agency Lead Management{% endblock %}

{% block content %}
<h1 class="mb-4">Analytics Dashboard</h1>

<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Lead Pipeline Status</h5>
            </div>
            <div class="card-body">
                <div id="pipelineChart" style="height: 400px;"></div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        {% if spending_json %}
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Spending Trends</h5>
            </div>
            <div class="card-body">
                <div id="spendingChart" style="height: 400px;"></div>
            </div>
        </div>
        {% else %}
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Spending Trends</h5>
            </div>
            <div class="card-body">
                <p class="text-muted">No spending data available yet.</p>
            </div>
        </div>
        {% endif %}
    </div>
</div>

{% if current_user.is_team_lead() and team_performance %}
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Team Performance</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Team Member</th>
                                <th>Activities Logged</th>
                                <th>Performance</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for member in team_performance %}
                            <tr>
                                <td>{{ member[0] }}</td>
                                <td>{{ member[1] }}</td>
                                <td>
                                    <div class="progress" style="height: 20px;">
                                        <div class="progress-bar" 
                                             role="progressbar" 
                                             style="width: {{ (member[1] / team_performance[0][1] * 100) if team_performance else 0 }}%">
                                            {{ member[1] }}
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Quick Actions</h5>
            </div>
            <div class="card-body">
                <a href="{{ url_for('advertisers.list_advertisers') }}" class="btn btn-primary me-2">
                    <i class="bi bi-building"></i> View All Advertisers
                </a>
                <a href="{{ url_for('activities.activity_feed') }}" class="btn btn-info me-2">
                    <i class="bi bi-activity"></i> Activity Feed
                </a>
                <a href="{{ url_for('reports.spending_analysis') }}" class="btn btn-success me-2">
                    <i class="bi bi-bar-chart"></i> Spending Analysis
                </a>
                {% if current_user.is_team_lead() %}
                <a href="{{ url_for('reports.export_data') }}?type=advertisers&format=csv" class="btn btn-outline-secondary">
                    <i class="bi bi-download"></i> Export CSV
                </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Render pipeline chart
    var pipelineData = {{ pipeline_json | safe }};
    Plotly.newPlot('pipelineChart', pipelineData.data, pipelineData.layout, {responsive: true});
    
    {% if spending_json %}
    // Render spending chart
    var spendingData = {{ spending_json | safe }};
    Plotly.newPlot('spendingChart', spendingData.data, spendingData.layout, {responsive: true});
    {% endif %}
</script>
{% endblock %}